#!/bin/bash

set -e # 脚本只要发生错误，就终止执行

# 初始化本地环境
# 用户自行安装 apt install nginx-core -y
#sed -i "s|www-data|root|g" /etc/nginx/nginx.conf
#export NGINX_CONFIG_DIR=/etc/nginx/conf.d
#export NGINX_HTML_DIR=/usr/share/nginx/html
export NGINX_CONFIG_DIR=/usr/local/etc/nginx/servers
export NGINX_HTML_DIR=/usr/local/Cellar/nginx/1.23.1/html

# https://stackoverflow.com/questions/428109/extract-substring-in-bash
# /etc/hosts 需要 root 权限
sudo echo "127.0.0.1 ${BEE_URL_LOCAL#*//}" >> /etc/hosts
ln -s $(pwd)/nginx/bee.peacetrue.local.conf $NGINX_CONFIG_DIR/bee.peacetrue.local.conf
ln -s $(pwd)/frontend/local $NGINX_HTML_DIR/bee

nginx -s reload

# https://stackoverflow.com/questions/42458434/how-to-set-build-env-variables-when-running-create-react-app-build-script
# https://github.com/toddbluhm/env-cmd

echo '安装前端依赖'
./macOS-dev-init
