= 用户手册

本文介绍如何运行 {page-component-name} 项目。

== 先决条件

读者需具有 https://www.java.com/zh-CN/[Java^]、 https://www.npmjs.com/[npm^] 知识背景。

== 成品展示

访问 http://bee.peacetrue.cn/function/conversion[{page-component-name}^] 网站查看演示效果。

== 运行

本机需安装 git(2+)、 jdk(8+)、node(14+)、npm(8.5+)、nginx(1.18+)，
同时确保 8080、8081 端口可用。

运行环境包括：

. 开发环境：在 IDE 中开发，域名为 localhost，允许跨域
. 本地环境：使用域名 bee.peacetrue.local，通过 nginx 配置为同域
. 生产环境：使用域名 bee.peacetrue.cn，通过 nginx 配置为同域

=== 检出源码

// https://askubuntu.com/questions/426750/how-can-i-update-my-nodejs-to-the-latest-version

[source%nowrap,bash,subs="specialchars,attributes"]
----
# 检出项目
git clone https://github.com/peacetrue/bee.git && cd bee
----

=== Ubuntu

在 Ubuntu 20+ 上运行 {page-component-name}。

.设置环境变量
[source%nowrap,bash,subs="specialchars,attributes"]
----
./set-env
----

.开发模式
[source%nowrap,bash,subs="specialchars,attributes"]
----
./ubuntu-dev-init
./ubuntu-dev-run-backend
./ubuntu-dev-run-frontend
----

.本地模式
[source%nowrap,bash,subs="specialchars,attributes"]
----
./ubuntu-local-init
./ubuntu-local-run-backend
./ubuntu-local-run-frontend
----

.生产模式
[source%nowrap,bash,subs="specialchars,attributes"]
----
./ubuntu-prod-init
./ubuntu-prod-run-backend
./ubuntu-prod-run-frontend
----

//TODO window 系统测试

=== 开发环境

.直接通过 IDE 运行，以 IntelliJ IDEA 为例：
* 链接 Gradle 项目

image:manual/link-gradle.png[]

* 运行后端 `BeeMainApplication`：

image:manual/backend.png[width=50%]

* 激活开发环境：

image:manual/dev.png[width=50%]

* 启动前端 `package.json`：

image:manual/frontend.png[width=50%]

.通过命令运行
[source%nowrap,bash,subs="specialchars,attributes"]
----
# 运行后端项目
./run-backend
# 运行前端项目
./run-frontend
----

// 访问：
// http://localhost:3000/function/conversion[数据转换功能^]。

=== 本地环境

本地环境指通过 NGINX 在本机运行，配置与生产环境保持一致，便于迁移到生产环境。
需在本地安装 https://www.nginx.com[NGINX^]。

.本地运行：
[source%nowrap,bash,subs="specialchars,attributes"]
----
# 在本机安装 Nginx
# 设置 Nginx 配置目录，Mac：/usr/local/etc/nginx，Ubuntu：/etc/nginx/
export NGINX_CONFIG_DIR=/usr/local/etc/nginx
# 设置 Nginx 静态资源目录；Mac：/usr/local/var/www，Ubuntu：/usr/share/nginx/html
export NGINX_HTML_DIR=/usr/local/var/www
# Nginx 主配置文件 nginx.conf 中需导入扩展配置 include servers/*;
ln -s $(pwd)/nginx/bee.peacetrue.local.conf $NGINX_CONFIG_DIR/servers/bee.peacetrue.local.conf
echo '127.0.0.1 bee.peacetrue.local' >> /etc/hosts
ln -s $(pwd)/frontend/build $NGINX_HTML_DIR/bee
# 打开 Google 浏览器
open -a "Google Chrome" http://localhost:3000
----

.Ubuntu：
[source%nowrap,bash,subs="specialchars,attributes"]
----
apt install nginx-core -y
# 在本机安装 Nginx
export NGINX_CONFIG_DIR=/etc/nginx
export NGINX_HTML_DIR=/usr/share/nginx/
# Nginx 主配置文件 nginx.conf 中需导入扩展配置 include servers/*;
ln -s $(pwd)/nginx/bee.peacetrue.local.conf $NGINX_CONFIG_DIR/servers/bee.peacetrue.local.conf
echo '127.0.0.1 bee.peacetrue.local' >> /etc/hosts
ln -s $(pwd)/frontend/build $NGINX_HTML_DIR/bee
# 打开 Google 浏览器
open -a "Google Chrome" http://localhost:3000

curl -s https://raw.githubusercontent.com/peacetrue/bee/local/ubuntu-server-init | bash
----

=== 生产环境


