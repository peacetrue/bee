= 架构

https://zhuanlan.zhihu.com/p/87855907[前后端分离架构^]。

== 项目结构

[plantuml,target=structure,format=png]
----
@startuml
[后端主应用] <--> [后端监控应用]: 相互调用
[后端主应用] <--  [前端应用]:    单向调用
@enduml
----

* 后端主应用：提供功能接口
* 后端监控应用：监控后端主应用运行状态及异常告警
* 前端应用：提供功能界面展示，调用后端主应用接口

== 部署模式

=== 本地

.本地部署模式
[plantuml,target=deployment-local,format=png]
----
@startuml
component Nginx

folder html{
    folder bee{
    }
}
note bottom of html: Nginx 静态文件目录
Nginx --> html: 读取

folder 前端{
    folder build{
    }
}
note right of build: 构建生成的静态资源文件
bee --> build: 软链接，保持各部分独立性

folder 后端{
    artifact 主应用
    artifact 监控应用
}

Nginx --> 主应用: 反向代理
主应用 --> 监控应用: 注册
主应用 <-- 监控应用: 获取监控指标
@enduml
----

.应用端口
* 前端应用：3000
* 后端监控应用：8080
* 后端主应用：8081

本地使用地址： http://bee.peacetrue.local 。

添加 hosts 条目：

./etc/hosts
[source%nowrap,bash]
----
echo '127.0.0.1 bee.peacetrue.local' >> /etc/hosts
----

Nginx 配置：

.bee.peacetrue.local
[source%nowrap,conf]
----
include::example$backend/nginx/bee.peacetrue.local.conf[]
----

=== 远程

远程部署模式与本地类似：

.远程部署模式
[plantuml,target=deployment-remote,format=png]
----
@startuml
component Nginx

folder html{
    folder bee{
    }
}
note bottom of html: Nginx 静态文件目录
note bottom of bee: 前端静态资源目录
Nginx --> html: 读取

folder 后端{
    artifact 主应用
    artifact 监控应用
}

Nginx --> 主应用: 反向代理
主应用 --> 监控应用: 注册
主应用 <-- 监控应用: 获取监控指标
@enduml
----

.应用端口
* 后端监控应用：8080
* 后端主应用：8081

远程使用地址： http://bee.peacetrue.cn 。

Nginx 配置：

.bee.peacetrue.cn
[source%nowrap,conf]
----
include::example$backend/nginx/bee.peacetrue.cn.conf[]
----
